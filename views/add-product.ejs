<%- include('header') %>

<link rel="stylesheet" href="/css/product.css">

<div class="product-container">

<h2>Add Product</h2>
<form id="productForm" method="POST" action="/manager/products/add">
  <input name="name" placeholder="Product Name" required>
  <textarea name="description" placeholder="Description" required></textarea>
  <input type="number" name="price" placeholder="Price" required>

  <!-- Replace submit with modal trigger -->
  <button type="button" onclick="showPasswordModal()">Add Product</button>
</form>

<!-- Redirect to dashboard -->
<a href="/dashboard"><button type="button">Go to Dashboard</button></a>

<p style="color:red;"><%= error %></p>

<!-- Success/Error Message Alert Box -->
<% if (message) { %>
  <script>
    alert("<%= message %>");
  </script>
<% } %>

<!-- Floating Username + Password Modal -->
<div id="passwordModal" class="modal">
  <div class="modal-content">
    <h3>Confirm Credentials</h3>
    <input type="text" id="confirmUsername" placeholder="Enter your username" required>
    <input type="password" id="confirmPassword" placeholder="Enter your password" required>
    <div class="modal-buttons">
      <button onclick="submitProduct()">Confirm</button>
      <button onclick="closePasswordModal()">Cancel</button>
    </div>
  </div>
</div>

<script>
    function showPasswordModal() {
      document.getElementById('passwordModal').style.display = 'flex';
    }
  
    function closePasswordModal() {
      document.getElementById('passwordModal').style.display = 'none';
    }
  
    function submitProduct() {
      const username = document.getElementById('confirmUsername').value.trim();
      const password = document.getElementById('confirmPassword').value.trim();
  
      if (!username || !password) {
        alert('Please enter both username and password.');
        return;
      }
  
      const form = document.getElementById('productForm');
  
      const hiddenUsername = document.createElement('input');
      hiddenUsername.type = 'hidden';
      hiddenUsername.name = 'username';
      hiddenUsername.value = username;
  
      const hiddenPassword = document.createElement('input');
      hiddenPassword.type = 'hidden';
      hiddenPassword.name = 'password';
      hiddenPassword.value = password;
  
      form.appendChild(hiddenUsername);
      form.appendChild(hiddenPassword);
  
      form.submit();
    }
</script>
</div>

<%- include('footer') %>

<script>
   window.onload = function() {
    setTimeout(function() {
      // Clear error and message from URL
      window.history.replaceState({}, document.title, window.location.pathname);
    }, 3000);  // Optional: Wait for 3 seconds before clearing
  };
</script>
