<%- include('header') %>

<h2>Your Orders</h2>
<% if (error) { %>
    <p style="color: red;"><%= error %></p>
  <% } %>
<% if (orders.length === 0) { %>
  <p>You haven't placed any orders yet.</p>
<% } else { %>
  <ul>
    <% orders.forEach(order => { %>
      <li>
        <strong><%= order.product.name %></strong> - Ordered on <%= new Date(order.createdAt).toLocaleString() %>
        <button onclick="openModal('<%= order._id %>')">Delete Order</button>

        <!-- Modal -->
        <div id="modal-<%= order._id %>" class="modal" style="display: none;">
          <div class="modal-content">
            <span class="close" onclick="closeModal('<%= order._id %>')">&times;</span>
            <h3>Confirm Delete</h3>
            <form action="/customer/order/<%= order._id %>/delete" method="POST">
              <input type="text" name="username" placeholder="Username" required>
              <input type="password" name="password" placeholder="Password" required>
              <button type="submit">Confirm Delete</button>
            </form>
          </div>
        </div>
      </li>
    <% }) %>
  </ul>
<% } %>

<a href="/customer/products">‚Üê Back to Products</a>

<%- include('footer') %>

<!-- Success Modal -->
<div id="successModal" class="modal" style="display: none;">
  <div class="modal-content">
    <span class="close" onclick="closeSuccessModal()">&times;</span>
    <h3>Order Deleted Successfully!</h3>
    <p>Your order has been successfully deleted.</p>
    <button onclick="closeSuccessModal()">Close</button>
  </div>
</div>

<!-- Modal Styles and Script -->
<style>
  .modal {
    position: fixed;
    z-index: 999;
    left: 0; top: 0;
    width: 100%; height: 100%;
    background-color: rgba(0,0,0,0.4);
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .modal-content {
    background-color: #fff;
    padding: 20px;
    border-radius: 10px;
    width: 300px;
    position: relative;
  }

  .close {
    position: absolute;
    top: 8px; right: 10px;
    font-size: 18px;
    cursor: pointer;
  }

  .modal button {
    margin-top: 10px;
  }
</style>

<script>
  function openModal(orderId) {
    document.getElementById('modal-' + orderId).style.display = 'flex';
  }

  function closeModal(orderId) {
    document.getElementById('modal-' + orderId).style.display = 'none';
  }

  function openSuccessModal() {
    document.getElementById('successModal').style.display = 'flex';
  }

  function closeSuccessModal() {
    document.getElementById('successModal').style.display = 'none';
  }

  // Optional: Close modal if user clicks outside the modal content
  window.onclick = function(event) {
    document.querySelectorAll('.modal').forEach(modal => {
      if (event.target === modal) {
        modal.style.display = "none";
      }
    });
  };

  window.onload = function() {
    setTimeout(function() {
      // Clear error and message from URL
      window.history.replaceState({}, document.title, window.location.pathname);
    }, 3000);  // Optional: Wait for 3 seconds before clearing
  };

</script>
