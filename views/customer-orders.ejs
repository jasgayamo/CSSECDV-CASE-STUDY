<%- include('header') %>

<link rel="stylesheet" href="/css/customer-orders.css">

<div class="orders-container">

<h2>Your Orders</h2>
<% if (error) { %>
    <p style="color: red;"><%= error %></p>
  <% } %>
<% if (orders.length === 0) { %>
  <p>You haven't placed any orders yet.</p>

  <% if (message) { %>
    <p style="color: green;"><%= message %></p>
    <script>openSuccessModal();</script>
  <% } %>
  
<% } else { %>
  <ul>
    <% orders.forEach(order => { %>
      <li>
        <strong><%= order.product.name %></strong> - Ordered on <%= new Date(order.createdAt).toLocaleString() %>
        <button onclick="openModal('<%= order._id %>')">Delete Order</button>

        <!-- Modal -->
        <div id="modal-<%= order._id %>" class="modal" style="display: none;">
          <div class="modal-content">
            <span class="close" onclick="closeModal('<%= order._id %>')">&times;</span>
            <h3>Confirm Delete</h3>
            <form action="/customer/order/<%= order._id %>/delete" method="POST">
              <input type="text" name="username" placeholder="Username" required>
              <input type="password" name="password" placeholder="Password" required>
              <button type="submit">Confirm Delete</button>
            </form>
          </div>
        </div>
      </li>
    <% }) %>
  </ul>
<% } %>

<a href="/customer/products">‚Üê Back to Products</a>

</div>

<%- include('footer') %>

<!-- Success Modal -->
<div id="successModal" class="modal" style="display: none;">
  <div class="modal-content">
    <span class="close" onclick="closeSuccessModal()">&times;</span>
    <h3>Order Deleted Successfully!</h3>
    <p>Your order has been successfully deleted.</p>
    <button onclick="closeSuccessModal()">Close</button>
  </div>
</div>

<script>
  function openModal(orderId) {
    document.getElementById('modal-' + orderId).style.display = 'flex';
  }

  function closeModal(orderId) {
    document.getElementById('modal-' + orderId).style.display = 'none';
  }

  function openSuccessModal() {
    document.getElementById('successModal').style.display = 'flex';
  }

  function closeSuccessModal() {
    document.getElementById('successModal').style.display = 'none';
  }

  // Optional: Close modal if user clicks outside the modal content
  window.onclick = function(event) {
    document.querySelectorAll('.modal').forEach(modal => {
      if (event.target === modal) {
        modal.style.display = "none";
      }
    });
  };

  window.onload = function() {
    setTimeout(function() {
      // Clear error and message from URL
      window.history.replaceState({}, document.title, window.location.pathname);
    }, 3000);  // Optional: Wait for 3 seconds before clearing
  };

</script>
